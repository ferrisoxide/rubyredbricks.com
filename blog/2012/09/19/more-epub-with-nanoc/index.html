<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv='X-UA-Compatible' content='IE=edge;chrome=1' />
    <title>Ruby Red Bricks - More ePub with nanoc</title>
    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/blog/feed.xml" />
    <link href="/stylesheets/all.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container">
      <div class="container-centered">
        <div class="banner">
          <div class="row">
            <div class="col-md-2">
              <a href="/">
                <img src="/images/avatar.png" class="image avatar">
              </a>
            </div>
            <div class="col-md-9">
              <a href="/">
                <h1>Ruby Red Bricks</h1>
              </a>
            </div>
          </div>
        </div>
        <div class="row"><hr class="jumbotron-hr"/></div>
        <div class="row post">
          <p>A little way back I posted a <a href="/blog/2012/09/06/quick-and-dirty-epub-with-nanoc/">lengthy article</a> on
how to create a e-book using ePub, the static website compiler <a href="http://nanoc.stoneship.org">nanoc</a> and some
quick and dirty code. In this much shorter post I'll aim to clean up the solution a little.</p>

<!---->

<h2 id="nanoc-meta-data">nanoc meta-data</h2>

<p>One of the nice things about <strong>nanoc</strong> is the capacity to add arbitrary meta-data to each page. In the original version of the e-book I used a convention based on the URL and <strong>nanoc</strong> identifier to link from one page to the next: page '/001/' precedes page '/002/' and so forth. It was crufty and required more gsubbing than was sound.</p>

<p>A cleaner approach is to put the data directly inside the page, within <strong>nanoc's</strong> meta-data block:</p>

<pre><code class="language-text">---
title: Epithelium
chapter: 1
page: 1
---
... page goes here ...
</code></pre>

<p>There are certain pages that I want to exclude from the ePub version (<em>e.g.</em> the website home page). Again, using meta-data the ePub compiler can directed to ignore specific content:</p>

<pre><code class="language-text">---
title: Home
exclude_from_epub: true
---
</code></pre>

<h2 id="using-the-preprocessor">Using the preprocessor</h2>

<p>Another useful feature in <strong>nanoc</strong> is the <strong>preprocess</strong> directive you can add to the <em>/Rules</em> file. Using this I can build an outline of the e-book from meta-data and hive it off to a <em>.yaml</em> for other parts of the code to use later.</p>

<pre><code class="language-ruby">preprocess do
  outline = {}

  @items.each do |item|
    unless item[:exclude_from_epub]
      chapter = item[:chapter]
      page = item[:page]
      title = item[:title]

      if chapter
        outline[chapter] = {} unless outline[chapter]
        outline[chapter][page] = {
          :label =&gt; item[:title],
          :file =&gt; item.identifier.gsub(/^\/|\/$/, '') + '.html' }
      end
    end
  end

  File.open("tmp/outline.yaml", "w") {|file| file.write outline.to_yaml }
end
</code></pre>

<p>The full code for the e-book can be found on <a href="https://github.com/ferrisoxide/this-purple-world">Github</a>.</p>

<p>Five more pages have been added to both the web and ePub versions of the book and are available <a href="http://thispurpleworld.com">online</a>. I'll be releasing more on a regular basis, so if you're interested in following the book's progress feel free to follow me on Twitter or look for the hashtag <em>#thispurpleworld</em>.</p>

<p><a data-show-count="false" class="twitter-follow-button" href="http://twitter.com/ferrisoxide">Follow @ferrisoxide</a></p>


        </div>

          <div class="row"><hr/></div>
          <div class="row">
            <div id="disqus_thread"></div>
<script type="text/javascript">
//<![CDATA[
                  var disqus_shortname = 'rubyredbricks';
                        var disqus_url = 'http://rubyredbricks.com/blog/2012/09/19/more-epub-with-nanoc/';
          
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
//]]>
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

          </div>

        <div class="row"><hr/></div>

        <div class="row contact">
          <div class="col-md-5">
          <ul class="icons">
            <li>
              <a href="mailto:ferrisoxide@gmail.com" class="icon fa-envelope-o">
                <span class="fui-mail"></span>
              </a>
            </li>

            <li>
                <a href="https://github.com/ferrisoxide" class="icon fa-github" target="_blank">
                  <span class="fui-github"></span>
              </a>
            </li>

            <li>
                <a href="https://twitter.com/ferrisoxide" class="icon fa-twitter" target="_blank">
                  <span class="fui-twitter"></span>
                </a>
              </a>
            </li>

            <li>
              <a href="https://linkedin.com/in/ferrisoxide" class="icon fa-linkedin" target="_blank">
                <span class="fui-linkedin"></span>
              </a>
            </li>

            <li>
              <a href="https://plus.google.com/+TomTuddenham" class="icon fa-google-plus" target="_blank">
                <span class="fui-google-plus"></span>
              </a>
            </li>

            <li>
              <a href="https://www.facebook.com/tom.tuddenham.7" class="icon fa-facebook" target="_blank">
                <span class="fui-googleplus"></span>
              </a>
            </li>


          </ul>
        </div>
      </div>
      </div>
    </div>

    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-4121694-1', 'auto');
  ga('send', 'pageview');

</script>

  </body>
  <script src="/javascripts/all.js"></script>
</html>
